<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Estufa</title>
    <!-- Carrega o Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // Configuração do Tailwind para usar a fonte Inter e cores customizadas
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-dark': '#1f2937', // Cinza escuro principal
                        'secondary-text': '#9ca3af', // Texto secundário mais claro
                        'accent-green': '#10b981', // Verde de destaque
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Estilos personalizados para a interface móvel */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background-color: #0d0d0d; /* Fundo bem escuro */
            padding-top: 1rem;
        }
        .app-container {
            width: 100%;
            max-width: 420px; /* Largura típica de celular */
            min-height: 80vh;
            background-color: #1a1a1a; /* Fundo do app */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border-radius: 1.5rem;
            padding: 1.5rem;
        }
        /* Estilo para os botões circulares (+/-) */
        .control-button {
            width: 3.5rem;
            height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #374151;
            font-size: 2rem;
            line-height: 1;
            transition: all 0.2s;
            user-select: none;
            cursor: pointer;
        }
        .control-button:hover {
            background-color: #374151;
        }
        .control-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="text-white">

    <div id="app-container" class="app-container">
        <!-- Cabeçalho -->
        <header class="flex justify-between items-center mb-6">
            <button class="text-2xl hover:text-gray-400 focus:outline-none">
                <!-- Ícone de Menu (Placeholder SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
            <h1 class="text-xl font-bold">MONITOR ESTUFA</h1>
            <button class="text-2xl hover:text-gray-400 focus:outline-none">
                <!-- Ícone de Configurações (Placeholder SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H12a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1h.09a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09z"></path></svg>
            </button>
        </header>

        <!-- Seção 1: TEMPERATURA -->
        <div class="bg-gray-800 p-6 rounded-xl mb-6">
            <div class="text-secondary-text mb-4 text-sm font-semibold tracking-wider">TEMPERATURA</div>

            <!-- Slider Simulado (Barra de progresso) -->
            <div class="h-2 bg-gray-700 rounded-full mb-8">
                <div id="temp-progress" class="h-full bg-red-500 rounded-full w-1/2 transition-all duration-500"></div>
            </div>

            <div class="flex justify-between items-center">
                <button id="temp-down" class="control-button border-red-500 text-red-500" aria-label="Diminuir Temperatura Alvo">-</button>
                
                <div class="text-center">
                    <div id="current-temp" class="text-6xl font-light leading-none">--°C</div>
                    <div class="mt-2 text-sm text-secondary-text">ALVO: <span id="target-temp">25</span>°C</div>
                </div>

                <button id="temp-up" class="control-button border-red-500 text-red-500" aria-label="Aumentar Temperatura Alvo">+</button>
            </div>

            <div class="text-center mt-4 pt-4 border-t border-gray-700">
                <div class="text-xs text-secondary-text tracking-widest">TEMPERATURA AMBIENTE EXTERNA: <span id="ambient-temp">24.2°C</span></div>
            </div>
        </div>

        <!-- Seção 2: UMIDADE (Simulando "Potência" da imagem, mas focado em umidade) -->
        <div class="bg-gray-800 p-6 rounded-xl mb-8">
            <div class="text-secondary-text mb-4 text-sm font-semibold tracking-wider">UMIDADE MÉDIA</div>
            
            <!-- Slider Simulado (Barra de progresso) -->
            <div class="h-2 bg-gray-700 rounded-full mb-8">
                <div id="humidity-progress" class="h-full bg-blue-500 rounded-full w-3/4 transition-all duration-500"></div>
            </div>

            <div class="flex justify-center space-x-12 items-center">
                <div class="text-center">
                    <div class="text-lg font-semibold text-secondary-text">AR</div>
                    <div id="air-humidity" class="text-4xl font-light text-blue-400">--%</div>
                </div>
                
                <div class="text-center">
                    <div class="text-lg font-semibold text-secondary-text">SOLO</div>
                    <div id="soil-humidity" class="text-4xl font-light text-blue-400">--%</div>
                </div>
            </div>

            <div class="text-center mt-4 pt-4 border-t border-gray-700">
                <div class="text-xs text-secondary-text tracking-widest">ALARME DE SECA ATIVO: <span id="dry-alarm" class="text-accent-green">NÃO</span></div>
            </div>
        </div>
        
        <!-- Seção 3: HISTÓRICO DE DADOS (Últimas 3 Leituras) -->
        <div class="bg-gray-800 p-6 rounded-xl mb-8">
            <div class="text-secondary-text mb-4 text-sm font-semibold tracking-wider text-center">ÚLTIMAS 3 LEITURAS (HISTÓRICO DO MYSQL)</div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-left text-sm text-white">
                    <thead class="uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="px-2 py-2">Hora</th>
                            <th scope="col" class="px-2 py-2">Temp (°C)</th>
                            <th scope="col" class="px-2 py-2">Umid. Ar (%)</th>
                            <th scope="col" class="px-2 py-2">Umid. Solo (%)</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="divide-y divide-gray-700">
                        <!-- Linhas de histórico serão inseridas aqui via JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Status Inferior -->
        <div class="text-center mt-8 pt-4 border-t border-gray-700">
            <div class="text-lg font-semibold text-gray-300">ESTUFA #1 - ALFA</div>
            <div class="text-sm text-secondary-text">MODO DE MONITORAMENTO ATIVO</div>
        </div>
    </div>

    <script>
        // A lógica do JavaScript está toda contida aqui, no final do arquivo HTML.

        // IMPORTANTE: Esta URL deve ser a sua API de back-end (Node.js, Python, PHP, etc.)
        // que fará a conexão com o MySQL para buscar os dados em tempo real.
        const API_URL = "SUA_URL_DA_API_DE_BACKEND_AQUI"; 

        // Elementos de UI
        const currentTempEl = document.getElementById('current-temp');
        const targetTempEl = document.getElementById('target-temp');
        const tempProgressEl = document.getElementById('temp-progress');
        const airHumidityEl = document.getElementById('air-humidity');
        const soilHumidityEl = document.getElementById('soil-humidity');
        const humidityProgressEl = document.getElementById('humidity-progress');
        const dryAlarmEl = document.getElementById('dry-alarm');
        const historyTableBodyEl = document.getElementById('history-table-body'); 

        // Estado do aplicativo (Temperatura alvo definida pelo usuário)
        let state = {
            targetTemperature: 25,
        };

        // Simulação de Histórico para demonstração. 
        // Em um ambiente real, este array viria diretamente do seu backend.
        let simulatedHistory = [
            { time: "10:00", temp: 22.5, air: 60, soil: 55 },
            { time: "10:05", temp: 22.8, air: 61, soil: 54 },
            { time: "10:10", temp: 23.0, air: 62, soil: 56 },
            { time: "10:15", temp: 23.2, air: 63, soil: 57 },
            { time: "10:20", temp: 23.5, air: 64, soil: 58 },
        ];


        // --- FUNÇÕES DE LÓGICA E CONEXÃO ---

        /**
         * FUNÇÃO DE BUSCA DE DADOS: 
         * Na sua aplicação real, você substituirá esta simulação por um 'fetch' para sua API.
         * * Esta função deve retornar um objeto no formato:
         * { 
         * currentTemp: number, 
         * airHumidity: number, 
         * soilHumidity: number, 
         * history: Array<{ time: string, temp: number, air: number, soil: number }> 
         * }
         */
        function fetchGreenhouseData() {
            // CÓDIGO DE SIMULAÇÃO (Para manter o app rodando sem o MySQL):
            const newReading = {
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                temp: (Math.random() * (28 - 18) + 18),
                air: (Math.random() * (90 - 40) + 40),
                soil: (Math.random() * (80 - 30) + 30),
            };
            
            // Adiciona a nova leitura ao histórico (mantendo 5 entradas para simulação)
            simulatedHistory.push(newReading);
            if (simulatedHistory.length > 5) {
                simulatedHistory.shift();
            }

            const simulatedData = {
                currentTemp: newReading.temp.toFixed(1),
                airHumidity: newReading.air.toFixed(0),
                soilHumidity: newReading.soil.toFixed(0),
                history: simulatedHistory
            };

            return simulatedData; // Retorna os dados simulados
            
            // --- CÓDIGO DE CONEXÃO REAL (EXEMPLO COMENTADO) ---
            /*
            // Se você usar esta parte, a 'mainLoop' precisa ser 'async'
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    console.error('Erro ao buscar dados da estufa:', response.statusText);
                    return null;
                }
                const realData = await response.json();
                return realData;
            } catch (error) {
                console.error("Erro na API:", error);
                return null;
            }
            */
        }

        /**
         * Atualiza a interface (DOM) com os dados recebidos.
         */
        function renderData(data) {
            if (!data) return;

            // 1. Temperatura
            currentTempEl.textContent = `${data.currentTemp}°C`;
            targetTempEl.textContent = state.targetTemperature;
            const currentTemp = parseFloat(data.currentTemp);
            
            // Lógica para a barra de progresso da Temperatura (ajusta o preenchimento visual)
            const tempPercentage = ((currentTemp - 18) / 10) * 100; // Assume range de 18°C a 28°C
            tempProgressEl.style.width = `${Math.min(100, Math.max(0, tempPercentage))}%`;

            // 2. Umidade
            airHumidityEl.textContent = `${data.airHumidity}%`;
            soilHumidityEl.textContent = `${data.soilHumidity}%`;
            
            // Umidade Média para o progresso
            const avgHumidity = (parseInt(data.airHumidity) + parseInt(data.soilHumidity)) / 2;
            humidityProgressEl.style.width = `${avgHumidity}%`;
            
            // Alarme de Seca (Solo < 40%)
            const isDry = parseInt(data.soilHumidity) < 40;
            dryAlarmEl.textContent = isDry ? 'SIM' : 'NÃO';
            dryAlarmEl.classList.toggle('text-red-500', isDry);
            dryAlarmEl.classList.toggle('text-accent-green', !isDry);

            // 3. Histórico de Dados
            if (data.history) {
                historyTableBodyEl.innerHTML = ''; // Limpa o corpo da tabela

                // Pega as ÚLTIMAS 3 entradas e inverte para mostrar a mais recente no topo.
                const lastThree = data.history.slice(-3).reverse(); 

                lastThree.forEach(entry => {
                    const row = historyTableBodyEl.insertRow();
                    row.className = 'hover:bg-gray-700 transition-colors';

                    // Hora formatada (ou como vier do seu MySQL)
                    row.insertCell().textContent = entry.time; 
                    // Temperatura
                    row.insertCell().textContent = entry.temp.toFixed(1);
                    // Umidade Ar
                    row.insertCell().textContent = entry.air.toFixed(0);
                    // Umidade Solo
                    row.insertCell().textContent = entry.soil.toFixed(0);
                    
                    // Adiciona classes Tailwind para espaçamento nas células
                    Array.from(row.cells).forEach(cell => {
                        cell.classList.add('px-2', 'py-2');
                    });
                });
            }
        }

        /**
         * Loop principal que chama a busca de dados e renderiza a interface.
         */
        function mainLoop() {
            // Esta função deve ser chamada repetidamente via 'setInterval'
            const data = fetchGreenhouseData();
            renderData(data);
        }

        // --- INICIALIZAÇÃO ---

        document.addEventListener('DOMContentLoaded', () => {
            // Listeners para controle de Temperatura Alvo
            document.getElementById('temp-up').addEventListener('click', () => {
                if (state.targetTemperature < 40) {
                    state.targetTemperature++;
                    mainLoop(); // Chama o loop para atualizar a interface imediatamente
                }
            });

            document.getElementById('temp-down').addEventListener('click', () => {
                if (state.targetTemperature > 15) {
                    state.targetTemperature--;
                    mainLoop(); // Chama o loop para atualizar a interface imediatamente
                }
            });

            // Inicia o loop de atualização a cada 3 segundos (simulando a leitura do sensor)
            setInterval(mainLoop, 3000); 

            // Roda a primeira vez para carregar os dados iniciais
            mainLoop();
        });
    </script>

</body>
</html>

